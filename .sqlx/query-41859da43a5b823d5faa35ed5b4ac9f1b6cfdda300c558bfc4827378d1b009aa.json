{
  "db_name": "PostgreSQL",
  "query": "\n            WITH\n                nft_periods AS (\n                    SELECT DISTINCT ON(a.collection_id, a.nft_id) \n                        a.collection_id, \n                        a.nft_id,\n                        (EXTRACT(EPOCH FROM a.block_time) - COALESCE(EXTRACT(EPOCH FROM a2.block_time), 0)) AS period \n                    FROM activities a\n                        LEFT JOIN activities a2 ON a2.receiver = a.sender AND a2.collection_id = a.collection_id AND a2.nft_id = a.nft_id\n                    WHERE a.collection_id = $1\n                        AND a.tx_type IN ('buy', 'transfer', 'mint')\n                    ORDER BY a.collection_id, a.nft_id, a.block_time DESC\n                )\n            SELECT\n                SUM(\n                    CASE \n                        WHEN np.period / EXTRACT(EPOCH FROM '1 day'::INTERVAL) < 1 THEN 1\n                        ELSE 0\n                    END\n                ) AS range_lt_24h,\n                SUM(\n                    CASE \n                        WHEN np.period / EXTRACT(EPOCH FROM '1 day'::INTERVAL) >= 1 AND np.period / EXTRACT(EPOCH FROM '1 day'::INTERVAL) < 7 THEN 1\n                        ELSE 0\n                    END\n                ) AS range_1d_to_7d,\n                SUM(\n                    CASE \n                        WHEN np.period / EXTRACT(EPOCH FROM '1 day'::INTERVAL) >= 7 AND np.period / EXTRACT(EPOCH FROM '1 day'::INTERVAL) < 30 THEN 1\n                        ELSE 0\n                    END\n                ) AS range_7d_to_30d,\n                SUM(\n                    CASE \n                        WHEN np.period / EXTRACT(EPOCH FROM '1 month'::INTERVAL) >= 1 AND np.period / EXTRACT(EPOCH FROM '1 month'::INTERVAL) < 3 THEN 1\n                        ELSE 0\n                    END\n                ) AS range_1m_to_3m,\n                SUM(\n                    CASE \n                        WHEN np.period / EXTRACT(EPOCH FROM '1 month'::INTERVAL) >= 3 AND np.period / EXTRACT(EPOCH FROM '1 year'::INTERVAL) < 1 THEN 1\n                        ELSE 0\n                    END\n                ) AS range_3m_to_1y,\n                SUM(\n                    CASE \n                        WHEN np.period / EXTRACT(EPOCH FROM '1 year'::INTERVAL) >= 3 THEN 1\n                        ELSE 0\n                    END\n                ) AS range_gte_1y\n            FROM nft_periods np\n            GROUP BY np.collection_id\n            ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "range_lt_24h",
        "type_info": "Int8"
      },
      {
        "ordinal": 1,
        "name": "range_1d_to_7d",
        "type_info": "Int8"
      },
      {
        "ordinal": 2,
        "name": "range_7d_to_30d",
        "type_info": "Int8"
      },
      {
        "ordinal": 3,
        "name": "range_1m_to_3m",
        "type_info": "Int8"
      },
      {
        "ordinal": 4,
        "name": "range_3m_to_1y",
        "type_info": "Int8"
      },
      {
        "ordinal": 5,
        "name": "range_gte_1y",
        "type_info": "Int8"
      }
    ],
    "parameters": {
      "Left": [
        "Text"
      ]
    },
    "nullable": [
      null,
      null,
      null,
      null,
      null,
      null
    ]
  },
  "hash": "41859da43a5b823d5faa35ed5b4ac9f1b6cfdda300c558bfc4827378d1b009aa"
}
