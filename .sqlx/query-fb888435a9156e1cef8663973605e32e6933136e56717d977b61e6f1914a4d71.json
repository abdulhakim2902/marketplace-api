{
  "db_name": "PostgreSQL",
  "query": "\n            WITH\n                bought_activities AS (\n                    SELECT a.collection_id, a.receiver AS address, COUNT(*) AS bought, SUM(price) AS price FROM activities a\n                    WHERE a.tx_type = 'buy' AND a.collection_id = $1\n                    GROUP BY a.collection_id, a.receiver \n                ),\n                sold_activities AS (\n                    SELECT a.collection_id, a.sender AS address, COUNT(*) AS sold, SUM(price) AS price FROM activities a\n                    WHERE a.tx_type = 'buy' AND a.collection_id = $1\n                    GROUP BY a.collection_id, a.sender\n                )\n            SELECT\n                w.address,\n                ba.bought, \n                sa.sold, \n                ba.price                                                                AS spent,\n                (COALESCE(sa.price, 0) - COALESCE(ba.price, 0)) \t                    AS total_profit\n            FROM wallets w\n                JOIN bought_activities ba ON ba.address = w.address\n                JOIN sold_activities sa ON sa.address = w.address\n            LIMIT $2 OFFSET $3\n            ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "address",
        "type_info": "Varchar"
      },
      {
        "ordinal": 1,
        "name": "bought",
        "type_info": "Int8"
      },
      {
        "ordinal": 2,
        "name": "sold",
        "type_info": "Int8"
      },
      {
        "ordinal": 3,
        "name": "spent",
        "type_info": "Numeric"
      },
      {
        "ordinal": 4,
        "name": "total_profit",
        "type_info": "Numeric"
      }
    ],
    "parameters": {
      "Left": [
        "Text",
        "Int8",
        "Int8"
      ]
    },
    "nullable": [
      false,
      null,
      null,
      null,
      null
    ]
  },
  "hash": "fb888435a9156e1cef8663973605e32e6933136e56717d977b61e6f1914a4d71"
}
