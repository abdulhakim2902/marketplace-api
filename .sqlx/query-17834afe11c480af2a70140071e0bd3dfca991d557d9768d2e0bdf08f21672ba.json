{
  "db_name": "PostgreSQL",
  "query": "\n            WITH \n                current_nft_owners AS (\n                    SELECT n.owner, COUNT(*) FROM nfts n\n                    WHERE n.burned IS NULL OR NOT n.burned AND n.collection_id = $1\n                    GROUP BY n.collection_id, n.owner\n                ),\n                transfer_in AS (\n                    SELECT a.collection_id, a.receiver AS address, COUNT(*) FROM activities a\n                    WHERE a.block_time >= NOW() - $2::INTERVAL \n                        AND a.tx_type = 'transfer'\n                        AND a.collection_id = $1\n                    GROUP BY a.collection_id, a.receiver\n                ),\n                transfer_out AS (\n                    SELECT a.collection_id, a.sender AS address, COUNT(*) FROM activities a\n                    WHERE a.block_time >= NOW() - $2::INTERVAL \n                        AND a.tx_type = 'transfer'\n                        AND a.collection_id = $1\n                    GROUP BY a.collection_id, a.sender\n                ),\n                unique_addresses AS (\n                    SELECT tin.address FROM transfer_in tin\n                    UNION\n                    SELECT tout.address FROM transfer_out tout\n                )\n            SELECT \n                ua.address, \n                (COALESCE(tout.count, 0) - COALESCE(tin.count, 0)) \tAS change,\n                COALESCE(co.count, 0) \t\t\t\t\t\t\t\tAS quantity\t\n            FROM unique_addresses ua\n                LEFT JOIN transfer_in tin ON tin.address = ua.address\n                LEFT JOIN transfer_out tout ON tout.address = ua.address\n                LEFT JOIN current_nft_owners co ON co.owner = ua.address\n            WHERE ua.address IS NOT NULL\n            ORDER BY change DESC\n            LIMIT $3 OFFSET $4\n            ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "address",
        "type_info": "Varchar"
      },
      {
        "ordinal": 1,
        "name": "change",
        "type_info": "Int8"
      },
      {
        "ordinal": 2,
        "name": "quantity",
        "type_info": "Int8"
      }
    ],
    "parameters": {
      "Left": [
        "Text",
        "Interval",
        "Int8",
        "Int8"
      ]
    },
    "nullable": [
      null,
      null,
      null
    ]
  },
  "hash": "17834afe11c480af2a70140071e0bd3dfca991d557d9768d2e0bdf08f21672ba"
}
